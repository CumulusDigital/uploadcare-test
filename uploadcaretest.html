<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Uploadcare Ad Uploader</title>

    <!-- Load Uploadcare widget -->
    <script src="https://cdn.jsdelivr.net/npm/@uploadcare/file-uploader@1/web/file-uploader-regular.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@uploadcare/file-uploader@1/web/uc-file-uploader-regular.min.css"
    />

    <style>
      body {
        font-family: sans-serif;
        padding: 2rem;
        margin: 0;
      }
      .error {
        color: red;
        margin-top: 1rem;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <h2>Upload Your Ad</h2>

    <!-- Uploadcare Config -->
    <uc-config ctx-name="ad-uploader" pubkey="a51c89007d0bce21876e"></uc-config>

    <!-- Upload Button Component -->
    <uc-file-uploader-regular ctx-name="ad-uploader"></uc-file-uploader-regular>

    <!-- Error Message Display -->
    <div id="error-message" class="error"></div>

    <script>
      const allowedDimensions = [
        [300, 250],
        [728, 90],
        [300, 600],
        [160, 600],
        [320, 50],
        [320, 480],
      ];
      const allowedFormats = ['image/png', 'image/jpeg', 'image/gif'];
      const maxFileSize = 500 * 1024;

      const errorEl = document.getElementById('error-message');
      const uploader = document.querySelector('uc-file-uploader-regular');

      uploader.addEventListener('change', async (event) => {
        errorEl.textContent = '';
        const file = event.detail.fileInfo;

        try {
          const blob = await file.copyTo('https://ucarecdn.com/');
          const fileInfo = await blob.promise();

          if (!allowedFormats.includes(fileInfo.mimeType)) {
            throw new Error('❌ Unsupported file format. Use JPG, PNG, or GIF.');
          }

          if (fileInfo.size > maxFileSize) {
            throw new Error('❌ File size exceeds 500 KB.');
          }

          const img = new Image();
          img.src = fileInfo.cdnUrl;

          await new Promise((resolve, reject) => {
            img.onload = () => {
              const valid = allowedDimensions.some(
                ([w, h]) => img.width === w && img.height === h
              );
              valid
                ? resolve()
                : reject(
                    new Error(
                      `❌ Incorrect dimensions: ${img.width}x${img.height}. Allowed: ${allowedDimensions
                        .map(([w, h]) => `${w}x${h}`)
                        .join(', ')}.`
                    )
                  );
            };
            img.onerror = () =>
              reject(new Error('❌ Failed to load image for dimension check.'));
          });
        } catch (err) {
          errorEl.textContent = err.message;
          uploader.value = '';
        }
      });
    </script>
  </body>
</html>
